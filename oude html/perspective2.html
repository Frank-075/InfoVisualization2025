<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Perspectief 2 – Beperkte impact EV-adoptie</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- D3 + Plotly -->
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://cdn.plot.ly/plotly-2.32.0.min.js"></script>

  <!-- Fonts + favicon -->
  <link rel="icon" type="image/png" href="images/favicon.png" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet" />

  <style>
    body{font-family:'Inter',sans-serif;background:#f3f4f6}
    .container{max-width:1000px}
    .section-title{border-bottom:2px solid #3b82f6;padding-bottom:.5rem;margin-bottom:1.5rem}
    .card{background:#fff;border-radius:.75rem;box-shadow:0 4px 6px rgba(0,0,0,.1);padding:1.5rem}
    .plot-container{background:#fff;border-radius:.75rem;box-shadow:0 2px 4px rgba(0,0,0,.05);padding:1rem;min-height:420px}
    .nav-link{padding:.75rem 1.25rem;border-radius:.5rem;transition:background .3s}
    .nav-link:hover{background:#e0f2fe}
    .nav-link.active{background:#bfdbfe;font-weight:600}
  </style>
</head>
<body class="antialiased text-gray-800">
<div class="container mx-auto p-6 lg:p-10 bg-white rounded-lg shadow-lg my-8 md:my-12">

  <!-- Navigatie -->
  <nav class="mb-8 p-4 bg-blue-700 text-white rounded-lg shadow-md flex flex-wrap justify-center gap-4">
    <a href="index.html"        class="nav-link">Introductie</a>
    <a href="dataset.html"      class="nav-link">Dataset&nbsp;&amp;&nbsp;Voorbewerking</a>
    <a href="perspective1.html" class="nav-link">Perspectief&nbsp;1</a>
    <a href="perspective2.html" class="nav-link active">Perspectief&nbsp;2</a>
    <a href="reflection.html"   class="nav-link">Reflectie&nbsp;&amp;&nbsp;Werkverdeling</a>
    <a href="results.html"      class="nav-link">Resultaten&nbsp;&amp;&nbsp;Conclusie</a>
  </nav>

  <!-- Inhoud -->
  <section class="mb-10 card">
    <h2 class="text-3xl font-semibold text-gray-800 section-title">
      Perspectief 2: Beperkte impact van EV-adoptie
    </h2>

    <p class="mb-6">
      Volgens dit perspectief is de bijdrage van EV’s aan de daling van CO₂-uitstoot minder doorslaggevend
      dan vaak wordt aangenomen. De visualisaties tonen (1) hoe de uitstoottendens per land niet uniform daalt en
      (2) hoe ongelijk de EV-penetratie in Europa momenteel is.
    </p>

    <!-- VIS 2.1 -->
    <h3 class="text-2xl font-medium text-gray-700 mt-6 mb-3">
      Visualisatie 2.1 – Evolutie CO₂-uitstoot per land
    </h3>
    <div id="co2EvolutionLineChart" class="plot-container"></div>

    <!-- VIS 2.2 -->
    <h3 class="text-2xl font-medium text-gray-700 mt-10 mb-3">
      Visualisatie 2.2 – EV-aandeel per land (interactieve kaart)
    </h3>
    <div id="evShareMap" class="plot-container"></div>
    <p class="text-sm text-gray-600 mt-4">
      Sleep de slider om te zien hoe de EV-penetratie zich sinds 2013 ontwikkelt. De kaart maakt duidelijk
      dat hoge percentages vooral geconcentreerd zijn in één of twee landen, terwijl grote delen van Europa
      onder de 5&nbsp;% blijven – een indicatie dat de totale impact op CO₂-uitstoot voorlopig beperkt is.
    </p>
  </section>

  <!-- Footer -->
  <footer class="text-center text-gray-500 text-sm mt-12 pt-8 border-t border-gray-200">
    <p>&copy; 2025 Groep 12 – InfoVis Project.</p>
    <p class="mt-1">
      <a href="https://github.com/TygoHonig/InfoVisualization2025" target="_blank" class="text-blue-600 hover:underline">
        Broncode op GitHub
      </a>
    </p>
  </footer>
</div>

<script>
/* ------------------ Bestanden ------------------ */
const carsCSV = 'data/cars_by_fuel.csv';
const co2CSV  = 'data/co2_new_cars.csv';

/* ------------ ISO‐code mapping (EU + EER) ------------ */
const isoMap = {
  AT:'AUT', BE:'BEL', BG:'BGR', HR:'HRV', CY:'CYP', CZ:'CZE', DK:'DNK', EE:'EST',
  FI:'FIN', FR:'FRA', DE:'DEU', EL:'GRC', HU:'HUN', IE:'IRL', IT:'ITA', LV:'LVA',
  LT:'LTU', LU:'LUX', MT:'MLT', NL:'NLD', PL:'POL', PT:'PRT', RO:'ROU', SK:'SVK',
  SI:'SVN', ES:'ESP', SE:'SWE', NO:'NOR', IS:'ISL', CH:'CHE', UK:'GBR'
};

/* Kleurschaal – Plotly ‘Viridis’ */
const colorScale = 'Viridis';

/* ------------- Data inladen ------------- */
Promise.all([d3.csv(carsCSV), d3.csv(co2CSV)])
.then(([carsRaw, co2Raw]) => {

  /* ---- 1. Maak samengestelde tabel ---- */
  const tmp = {}; // key: geo-year
  carsRaw.forEach(r=>{
    const key = `${r.geo}-${r.TIME_PERIOD}`;
    if(!tmp[key]) tmp[key]={geo:r.geo,year:+r.TIME_PERIOD,elc:0,total:0};
    if(r.mot_nrg==='ELC')   tmp[key].elc   = +r.OBS_VALUE;
    if(r.mot_nrg==='TOTAL') tmp[key].total = +r.OBS_VALUE;
  });
  co2Raw.forEach(r=>{
    const key = `${r.geo}-${r.TIME_PERIOD}`;
    if(tmp[key]) tmp[key].co2 = +r.OBS_VALUE;
  });

  const rows = Object.values(tmp)
               .filter(d=>d.total>0 && d.co2!==undefined)
               .map(d=>({...d, evShare:d.elc/d.total*100, iso3:isoMap[d.geo]}))
               .filter(d=>d.iso3); // alleen landen met iso3-code

  /* ---------------- VIS 2.1 ---------------- */
  const focusCodes = ['NL','DE','NO','PL','FR','ES'];
  const lineTraces = focusCodes.map(code=>{
    const serie = rows.filter(d=>d.geo===code).sort((a,b)=>a.year-b.year);
    return {
      x: serie.map(d=>d.year),
      y: serie.map(d=>d.co2),
      mode:'lines+markers',
      name: code,
      hovertemplate:`${code}<br>Jaar %{x}<br>CO₂ %{y:.1f} g/km<extra></extra>`
    };
  });
  Plotly.newPlot('co2EvolutionLineChart', lineTraces,{
    title:'Gem. CO₂-uitstoot nieuwe auto’s (2013-2023)',
    xaxis:{title:'Jaar',dtick:2},
    yaxis:{title:'CO₂ (g/km)'},
    margin:{t:60,r:20,b:40,l:60},
    hovermode:'closest'
  },{responsive:true});

  /* ---------------- VIS 2.2 ---------------- */
  const years = [...new Set(rows.map(r=>r.year))].sort((a,b)=>a-b);
  /* Bepaal dynamisch z-max (boven de 98e percentiel) voor betere kleurspreiding */
  const zVals = rows.map(d=>d.evShare).sort((a,b)=>a-b);
  const zmax = zVals[Math.floor(0.98*zVals.length)] || 30;

  const frames = years.map(yr=>{
    const yrRows = rows.filter(d=>d.year===yr);
    return {
      name:String(yr),
      data:[{
        type:'choropleth',
        locations:yrRows.map(d=>d.iso3),
        z:yrRows.map(d=>d.evShare),
        text:yrRows.map(d=>`${d.geo}: ${d.evShare.toFixed(2)} %`),
        colorscale:colorScale,
        zmin:0, zmax,
        colorbar:{title:'EV-aandeel %', ticksuffix:'%'},
        hovertemplate:'%{text}<extra></extra>'
      }]
    };
  });

  Plotly.newPlot('evShareMap', frames[0].data,{
    title:`EV-aandeel per land (${years[0]})`,
    geo:{scope:'europe',projection:{type:'natural earth'},showframe:false,showcountries:true},
    margin:{t:60,r:0,b:10,l:0},
    sliders:[{
      steps:years.map(y=>({label:String(y),method:'animate',
        args:[[String(y)],{mode:'immediate',frame:{duration:500,redraw:false},
                           transition:{duration:300}}]})),
      pad:{t:30},
      currentvalue:{prefix:'Jaar: ',font:{size:16}}
    }]
  },{responsive:true}).then(()=>Plotly.addFrames('evShareMap',frames));

})
.catch(e=>console.error('Data-load error',e));
</script>
</body>
</html>
